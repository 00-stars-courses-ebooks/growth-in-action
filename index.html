<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Growth 实战篇 Django版 - </title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="style.css">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <meta name="viewport" content="width=device-width">
</head>
<body>
<h1>Growth 实战篇 Django版</h1>
<p>By <a href="https://www.phodal.com/">Phodal</a>(Follow me: <a href="http://weibo.com/phodal">微博</a>、<a href="https://www.zhihu.com/people/phodal">知乎</a>、<a href="https://segmentfault.com/u/phodal">SegmentFault</a>)
</p>

<p>GitHub: <a href="https://github.com/phodal/growth-in-action-django">Growth 实战篇 Django版</a></p>

<p>微信公众号</p>
<p><img src="https://raw.githubusercontent.com/phodal/growth/master/www/img/wechat.jpg" alt=""/></p>
<div style="width:800px">

<iframe src="http://ghbtns.com/github-btn.html?user=phodal&repo=growth-in-action-django&type=watch&count=true"
        allowtransparency="true" frameborder="0" scrolling="0" width="110px" height="20px"></iframe>
</div>
<nav id="TOC">
<ul>
<li><a href="#growth-in-action-django">Growth In Action Django</a></li>
<li><a href="#深入浅出django">深入浅出Django</a><ul>
<li><a href="#django简介">Django简介</a></li>
<li><a href="#django-helloworld">Django hello,world</a><ul>
<li><a href="#安装django">安装Django</a></li>
<li><a href="#创建项目">创建项目</a></li>
<li><a href="#django后台">Django后台</a></li>
</ul></li>
<li><a href="#django应用架构">Django应用架构</a></li>
</ul></li>
<li><a href="#django创建博客应用">Django创建博客应用</a><ul>
<li><a href="#实战">实战</a></li>
<li><a href="#model">Model</a></li>
<li><a href="#template">Template</a></li>
<li><a href="#view">View</a></li>
</ul></li>
<li><a href="#功能测试">功能测试</a><ul>
<li><a href="#selenium">Selenium</a></li>
</ul></li>
<li><a href="#更多功能">更多功能</a><ul>
<li><a href="#comments">Comments</a></li>
<li><a href="#category">Category</a></li>
<li><a href="#practise">Practise</a><ul>
<li><a href="#monthly">Monthly</a></li>
<li><a href="#seo">SEO</a></li>
</ul></li>
</ul></li>
<li><a href="#前端框架">前端框架</a><ul>
<li><a href="#技能选型">技能选型</a></li>
</ul></li>
<li><a href="#api">API</a><ul>
<li><a href="#restful">RESTful</a></li>
<li><a href="#cors">CORS</a></li>
</ul></li>
<li><a href="#移动应用">移动应用</a><ul>
<li><a href="#ionic-2">Ionic 2</a></li>
<li><a href="#login">Login</a><ul>
<li><a href="#json-web-tokens">Json Web Tokens</a></li>
</ul></li>
<li><a href="#todo">TODO</a></li>
</ul></li>
<li><a href="#前端重构">前端重构</a><ul>
<li><a href="#mvvm">MVVM</a></li>
<li><a href="#ux">UX</a></li>
</ul></li>
<li><a href="#回顾">回顾</a></li>
</ul>
</nav>
<h1 id="growth-in-action-django">Growth In Action Django</h1>
<h1 id="深入浅出django">深入浅出Django</h1>
<h2 id="django简介">Django简介</h2>
<p>Django是一个高级的Python Web开发框架，它的目标是使得开发复杂的、数据库驱动的网站变得更加简单。</p>
<p>由于Django最初是被开发来用于管理劳伦斯出版集团旗下的一些以新闻内容为主的网站的。所以，我们可以发现在使用Django的很多网站里，都是用于作为CMS（内容管理系统）来使用的。使用Django的一些比较知名的网站如下图所示：</p>
<figure>
<img src="images/who-use-django.jpg" alt="使用Django的网站" /><figcaption>使用Django的网站</figcaption>
</figure>
<p>Django是一个MTC框架，其架构模板看上去与传统的MVC架构并没有太大的区别。其对比如下表所示：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">传统的MVC架构</th>
<th style="text-align: left;">Django 架构</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Model</td>
<td style="text-align: left;">Model(Data Access Logic)</td>
</tr>
<tr class="even">
<td style="text-align: left;">View</td>
<td style="text-align: left;">Template(Presentation Logic)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">View</td>
<td style="text-align: left;">View(Business Logic)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Controller</td>
<td style="text-align: left;">Django itself</td>
</tr>
</tbody>
</table>
<p>在Django中View只用来描述你要看到的内容，Template才是最后用于显示的内容。而在MVC架构中，这只相当于是View层。</p>
<h2 id="django-helloworld">Django hello,world</h2>
<h3 id="安装django">安装Django</h3>
<p><strong>virtualenv</strong></p>
<p>To install virtualenv via pip $ pip3 install virtualenv</p>
<p>Note that virtualenv installs to the python3 directory. For me it’s: $ /usr/local/share/python3/virtualenv</p>
<p>Create a virtualenvs directory to store all virtual environments $ mkdir somewhere/virtualenvs</p>
<p>Make a new virtual environment with no packages $ virtualenv somewhere/virtualenvs/<project-name> –no-site-packages</p>
<p>To use the virtual environment $ cd somewhere/virtualenvs/<project-name>/bin $ source activate</p>
<p>You are now using the virtual environment for <project-name>. To stop: $ deactivate</p>
<p>Install Django $ pip install django</p>
<p>Process</p>
<pre><code>Collecting django
  Downloading Django-1.9.4-py2.py3-none-any.whl (6.6MB)
    94% |██████████████████████████████▎ | 6.2MB 251kB/s eta 0:00:02</code></pre>
<h3 id="创建项目">创建项目</h3>
<p>$ django-admin startproject blog</p>
<p>Toc</p>
<pre><code>.
├── blog
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
└── manage.py</code></pre>
<p>$ python manage.py runserver</p>
<pre><code>Performing system checks...

System check identified no issues (0 silenced).

You have unapplied migrations; your app may not work properly until they are applied.
Run &#39;python manage.py migrate&#39; to apply them.

March 24, 2016 - 03:07:34
Django version 1.9.4, using settings &#39;blog.settings&#39;
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
Not Found: /
[24/Mar/2016 03:07:35] &quot;GET / HTTP/1.1&quot; 200 1767
Not Found: /favicon.ico
[24/Mar/2016 03:07:36] &quot;GET /favicon.ico HTTP/1.1&quot; 404 1934</code></pre>
<h3 id="django后台">Django后台</h3>
<figure>
<img src="images/django-backend.jpg" alt="Django后台" /><figcaption>Django后台</figcaption>
</figure>
<p>$ python manage.py migrate</p>
<pre><code>Operations to perform:
  Apply all migrations: sessions, admin, auth, contenttypes
Running migrations:
  Rendering model states... DONE
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying sessions.0001_initial... OK
(growth-django)</code></pre>
<p>$ python manage.py createsuperuser</p>
<pre><code>Username (leave blank to use &#39;fdhuang&#39;): root
Email address: h@phodal.com
Password:
Password (again):
Superuser created successfully.</code></pre>
<h2 id="django应用架构">Django应用架构</h2>
<h1 id="django创建博客应用">Django创建博客应用</h1>
<h3 id="实战">实战</h3>
<p>$ django-admin startapp blogpost</p>
<pre><code>.
├── __init__.py
├── admin.py
├── apps.py
├── migrations
│   └── __init__.py
├── models.py
├── tests.py
└── views.py</code></pre>
<h2 id="model">Model</h2>
<pre><code>from django.db import models
from django.db.models import permalink


class Blogpost(models.Model):
    title = models.CharField(max_length=100, unique=True)
    author = models.CharField(max_length=100, unique=True)
    slug = models.SlugField(max_length=100, unique=True)
    body = models.TextField()
    posted = models.DateField(db_index=True, auto_now_add=True)

    def __unicode__(self):
        return &#39;%s&#39; % self.title

    @permalink
    def get_absolute_url(self):
        return (&#39;view_blog_post&#39;, None, { &#39;slug&#39;: self.slug })</code></pre>
<h2 id="template">Template</h2>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html">{% extends &#39;base.html&#39; %}
{% block head_title %}{{ post.title }}{% endblock %}
{% block title %}{{ post.title }}{% endblock %}

{% block content %}
    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;mdl-card mdl-shadow--2dp&quot;</span><span class="kw">&gt;</span>
      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;mdl-card__title&quot;</span><span class="kw">&gt;</span>
         <span class="kw">&lt;h2</span><span class="ot"> class=</span><span class="st">&quot;mdl-card__title-text&quot;</span><span class="kw">&gt;&lt;a</span><span class="ot"> href=</span><span class="st">&quot;{{ post.get_absolute_url }}&quot;</span><span class="kw">&gt;</span>{{ post.title }}<span class="kw">&lt;/a&gt;&lt;/h2&gt;</span>
      <span class="kw">&lt;/div&gt;</span>
      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;mdl-card__supporting-text&quot;</span><span class="kw">&gt;</span>
          {{post.body}}
      <span class="kw">&lt;/div&gt;</span>
      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;mdl-card__actions&quot;</span><span class="kw">&gt;</span>
         {{post.posted}} - By {{post.author}}
      <span class="kw">&lt;/div&gt;</span>
    <span class="kw">&lt;/div&gt;</span>
{% endblock %}</code></pre></div>
<h2 id="view">View</h2>
<pre><code># Create your views here.
from blogpost.models import Blogpost

def index(request):
    return render_to_response(&#39;index.html&#39;, {
        &#39;posts&#39;: Blogpost.objects.all()[:5]
    })

def view_post(request, slug):
    return render_to_response(&#39;blogpost_detail.html&#39;, {
        &#39;post&#39;: get_object_or_404(Blogpost, slug=slug)
    })</code></pre>
<h1 id="功能测试">功能测试</h1>
<h2 id="selenium">Selenium</h2>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">from</span> django.test <span class="im">import</span> LiveServerTestCase
<span class="im">from</span> selenium <span class="im">import</span> webdriver

<span class="kw">class</span> HomepageTestCase(LiveServerTestCase):
    <span class="kw">def</span> setUp(<span class="va">self</span>):
        <span class="va">self</span>.selenium <span class="op">=</span> webdriver.Firefox()
        <span class="va">self</span>.selenium.maximize_window()
        <span class="bu">super</span>(HomepageTestCase, <span class="va">self</span>).setUp()

    <span class="kw">def</span> tearDown(<span class="va">self</span>):
        <span class="va">self</span>.selenium.quit()
        <span class="bu">super</span>(HomepageTestCase, <span class="va">self</span>).tearDown()

    <span class="kw">def</span> test_create_user(<span class="va">self</span>):
        <span class="va">self</span>.selenium.get(
            <span class="st">&#39;</span><span class="sc">%s%s</span><span class="st">&#39;</span> <span class="op">%</span> (<span class="va">self</span>.live_server_url,  <span class="st">&quot;/&quot;</span>)
        )

        <span class="va">self</span>.assertIn(<span class="st">&quot;Welcome to my blog&quot;</span>, <span class="va">self</span>.selenium.title)</code></pre></div>
<pre><code>class BlogpostFromHomepageCase(LiveServerTestCase):
    def setUp(self):
        Blogpost.objects.create(
            title=&#39;hello&#39;,
            author=&#39;admin&#39;,
            slug=&#39;this_is_a_test&#39;,
            body=&#39;This is a blog&#39;,
            posted=datetime.now
        )

        self.selenium = webdriver.Firefox()
        self.selenium.maximize_window()
        super(BlogpostFromHomepageCase, self).setUp()

    def tearDown(self):
        self.selenium.quit()
        super(BlogpostFromHomepageCase, self).tearDown()

    def test_visit_blog_post(self):
        self.selenium.get(
            &#39;%s%s&#39; % (self.live_server_url,  &quot;/&quot;)
        )

        self.selenium.find_element_by_link_text(&quot;hello&quot;).click()
        self.assertIn(&quot;hello&quot;, self.selenium.title)</code></pre>
<pre><code>
class BlogpostDetailCase(LiveServerTestCase):
    def setUp(self):
        Blogpost.objects.create(
            title=&#39;hello&#39;,
            author=&#39;admin&#39;,
            slug=&#39;this_is_a_test&#39;,
            body=&#39;This is a blog&#39;,
            posted=datetime.now
        )

        self.selenium = webdriver.Firefox()
        self.selenium.maximize_window()
        super(BlogpostDetailCase, self).setUp()

    def tearDown(self):
        self.selenium.quit()
        super(BlogpostDetailCase, self).tearDown()

    def test_visit_blog_post(self):
        self.selenium.get(
            &#39;%s%s&#39; % (self.live_server_url,  &quot;/blog/this_is_a_test.html&quot;)
        )

        self.assertIn(&quot;hello&quot;, self.selenium.title)</code></pre>
<h1 id="更多功能">更多功能</h1>
<h2 id="comments">Comments</h2>
<h2 id="category">Category</h2>
<h2 id="practise">Practise</h2>
<h3 id="monthly">Monthly</h3>
<h3 id="seo">SEO</h3>
<h1 id="前端框架">前端框架</h1>
<h2 id="技能选型">技能选型</h2>
<h1 id="api">API</h1>
<h2 id="restful">RESTful</h2>
<h2 id="cors">CORS</h2>
<h1 id="移动应用">移动应用</h1>
<h2 id="ionic-2">Ionic 2</h2>
<h2 id="login">Login</h2>
<h3 id="json-web-tokens">Json Web Tokens</h3>
<h2 id="todo">TODO</h2>
<h1 id="前端重构">前端重构</h1>
<h2 id="mvvm">MVVM</h2>
<h2 id="ux">UX</h2>
<h1 id="回顾">回顾</h1>
</body>
</html>
